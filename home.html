<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NBLAC — Mosaic Flip Hero</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { ink: {950:"#0b0b0b"}, sub:"#b5b5b5" },
          boxShadow: { soft: "0 10px 30px rgba(0,0,0,.35)" }
        }
      }
    }
  </script>
  <style>
    .flip-scene { perspective: 900px; }
    .flip-card { transform-style: preserve-3d; transition: transform 800ms cubic-bezier(.2,.7,.2,1); }
    .flip-card.flipped { transform: rotateY(180deg); }
    .flip-face { backface-visibility: hidden; }
    .flip-back { transform: rotateY(180deg); }

    /* faces */
    .front-face img { display:block; width:100%; height:100%; object-fit:cover; }
    .back-face {
      background-repeat: no-repeat;
      /* background-image/size/position set inline via JS per tile */
      border: 1px solid rgba(255,255,255,.12);
      background-color: rgba(0,0,0,.15); /* subtle glass so edges read */
    }

    /* accessibility */
    @media (prefers-reduced-motion: reduce) {
      .flip-card { transition: none !important; }
    }
  </style>
</head>
<body class="bg-ink-950 text-white">
  <section class="relative min-h-[90svh] grid place-items-center overflow-hidden">
    <!-- Optional faint heading behind for vibe (doesn't affect the mosaic) -->
    <div aria-hidden="true" class="absolute inset-0 grid place-items-center pointer-events-none select-none">
      <h1 class="text-center font-semibold tracking-tight opacity-[0.05] text-6xl sm:text-7xl md:text-8xl">NBLAC</h1>
    </div>

    <!-- Grid container -->
    <div id="grid"
         class="relative z-10 w-full max-w-6xl
                grid grid-cols-3 [grid-auto-rows:1fr] gap-0 p-3
                sm:gap-0 sm:p-6
                md:grid-cols-6 md:gap-0 lg:max-w-7xl">
    </div>

    <div class="absolute top-4 right-4 flex gap-2">
      <button id="revealNow" class="text-xs px-3 py-1.5 border border-white/15 hover:border-white/30 bg-white/5 backdrop-blur">Reveal heading now</button>
    </div>

    <p class="absolute bottom-4 left-0 right-0 text-center text-xs text-sub">
      Tiles flip randomly; every few seconds they sync to show the full heading.
    </p>
  </section>

  <script>
    // ---------- CONFIG ----------
    // Replace with your actual square-ish product images
    const images = [
      { src: "https://images.unsplash.com/photo-1511385348-a52b4a160dc2?q=80&w=800&auto=format&fit=crop", alt: "Wallet" },
      { src: "https://images.unsplash.com/photo-1517841905240-472988babdf9?q=80&w=800&auto=format&fit=crop", alt: "Watch" },
      { src: "https://images.unsplash.com/photo-1520975682031-cd2752abed26?q=80&w=800&auto=format&fit=crop", alt: "Hoodie" },
      { src: "https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=800&auto=format&fit=crop", alt: "T-Shirt" },
      { src: "https://images.unsplash.com/photo-1520975661595-6453be3f7070?q=80&w=800&auto=format&fit=crop", alt: "Cap" },
      { src: "https://images.unsplash.com/photo-1504384308090-c894fdcc538d?q=80&w=800&auto=format&fit=crop", alt: "Notebook" },
      { src: "https://images.unsplash.com/photo-1516542076529-1ea3854896e1?q=80&w=800&auto=format&fit=crop", alt: "Pen" },
      { src: "https://images.unsplash.com/photo-1512496015851-a90fb38ba796?q=80&w=800&auto=format&fit=crop", alt: "Backpack" },
      { src: "https://images.unsplash.com/photo-1512436991641-6745cdb1723f?q=80&w=800&auto=format&fit=crop", alt: "Sunglasses" },
      { src: "https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=800&auto=format&fit=crop", alt: "Tech Accessory" },
    ];

    // Grid layout: phones = 3x5 (15 tiles); md+ = 6x5 (30 tiles)
    const mobileCols = 3, mobileRows = 5;
    const desktopCols = 6, desktopRows = 5;

    // Flip timing
    const MIN_DELAY = 1200;   // per-tile random delay
    const MAX_DELAY = 4200;
    const FLIP_DURATION = 850;

    // Sync reveal cadence
    const SYNC_EVERY_MS = 6000;  // every 6s, flip all to show heading
    const SYNC_HOLD_MS  = 5000;  // keep the heading visible for ~5s

    const grid = document.getElementById("grid");
    const revealBtn = document.getElementById("revealNow");

    // ---------- Create a shared heading image as SVG (crisp at any size) ----------
    // You can replace this with your own PNG/SVG URL if you prefer.
    function makeHeadingDataURI() {
      const svg = `
        <svg xmlns='http://www.w3.org/2000/svg' width='1600' height='600' viewBox='0 0 1600 600'>
          <defs>
            <linearGradient id='g' x1='0' y1='0' x2='0' y2='1'>
              <stop offset='0' stop-color='#ffffff' stop-opacity='1'/>
              <stop offset='1' stop-color='#dddddd' stop-opacity='1'/>
            </linearGradient>
          </defs>
          <rect width='100%' height='100%' fill='transparent'/>
          <g font-family='Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji", "Segoe UI Emoji"' text-anchor='middle'>
            <text x='800' y='320' font-size='220' font-weight='800' fill='url(#g)'>NBLAC</text>
            <text x='800' y='420' font-size='56' font-weight='600' fill='#cfcfcf'>Essentials in Black</text>
          </g>
        </svg>`;
      return "url('data:image/svg+xml;utf8," + encodeURIComponent(svg) + "')";
    }
    const HEADING_BG = makeHeadingDataURI();

    // ---------- Helpers ----------
    const mqMd = () => window.matchMedia("(min-width: 768px)").matches;
    const dims = () => mqMd()
      ? { cols: desktopCols, rows: desktopRows }
      : { cols: mobileCols, rows: mobileRows };

    let buildVersion = 0;    // cancel stale timers across rebuilds
    let revealing = false;   // during sync hold, pause random flips

    function buildGrid() {
      buildVersion++;
      const v = buildVersion;

      grid.innerHTML = "";
      const { cols, rows } = dims();
      const count = cols * rows;

      // background-size so each tile shows 1/cols × 1/rows slice
      const bgSize = `${cols * 100}% ${rows * 100}%`;

      for (let i = 0; i < count; i++) {
        const col = i % cols;
        const row = Math.floor(i / cols);

        // Tile skeleton
        const scene = document.createElement("div");
        scene.className = "flip-scene aspect-square";

        const card = document.createElement("div");
        card.className = "flip-card relative w-full h-full rounded-lg overflow-hidden shadow-soft";

        // FRONT: product image
        const front = document.createElement("div");
        front.className = "flip-face front-face absolute inset-0";
        const img = document.createElement("img");
        const chosen = images[i % images.length];
        img.src = chosen.src;
        img.alt = chosen.alt;
        front.appendChild(img);

        // BACK: mosaic slice of heading
        const back = document.createElement("div");
        back.className = "flip-face flip-back back-face absolute inset-0 grid place-items-center";
        back.style.backgroundImage = HEADING_BG;
        back.style.backgroundSize = bgSize;

        // Position the slice (percentages align the mosaic)
        const posX = (cols > 1) ? (col / (cols - 1)) * 100 : 0;
        const posY = (rows > 1) ? (row / (rows - 1)) * 100 : 0;
        back.style.backgroundPosition = `${posX}% ${posY}%`;

        // Optional overlay for subtle grid edge
        const border = document.createElement("div");
        border.className = "pointer-events-none absolute inset-0 rounded-lg border border-white/10";

        card.appendChild(front);
        card.appendChild(back);
        card.appendChild(border);
        scene.appendChild(card);
        grid.appendChild(scene);

        // attach refs
        scene._card = card;

        // start per-tile random flip loop
        scheduleRandomFlip(scene, v);
      }
    }

    function flip(tile, forceState = null) {
      const card = tile?._card;
      if (!card) return;
      if (forceState === true) card.classList.add("flipped");
      else if (forceState === false) card.classList.remove("flipped");
      else card.classList.toggle("flipped");
    }

    function randomDelay(min = MIN_DELAY, max = MAX_DELAY) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function scheduleRandomFlip(tile, version) {
      const run = () => {
        if (version !== buildVersion) return;          // canceled by rebuild
        if (revealing) {                               // pause during reveal hold
          setTimeout(run, 200);
          return;
        }
        // 50/50 flip or unflip for variety
        const isFlipped = tile._card.classList.contains("flipped");
        flip(tile, Math.random() < 0.5 ? !isFlipped : null);
        setTimeout(run, randomDelay());
      };
      setTimeout(run, randomDelay());
    }

    // Sync reveal: flip every tile to BACK and hold
    function revealHeading() {
      revealing = true;
      [...grid.children].forEach(tile => flip(tile, true)); // all to back (mosaic visible)
      setTimeout(() => { revealing = false; }, SYNC_HOLD_MS);
    }

    // ---------- Init & behaviors ----------
    buildGrid();
    window.addEventListener("resize", () => {
      // rebuild only if tile count changes (i.e., breakpoint crossed)
      const { cols, rows } = dims();
      if (grid.children.length !== cols * rows) buildGrid();
    });

    // periodic sync
    setInterval(revealHeading, SYNC_EVERY_MS);

    // manual button
    document.getElementById("revealNow").addEventListener("click", revealHeading);
  </script>
</body>
</html>
